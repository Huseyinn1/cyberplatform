{% extends 'partials/_base.html' %}
{% load static %}

{% block content %}
<style>
    .log-container {
        font-family: 'Inter', sans-serif;
        color: #e0e0e0;
        position: relative;
        min-height: 80vh;
        display: flex;
        overflow: hidden;
        background-color: #121212;
    }

    .dashboard {
        width: 100%;
        padding: 2rem;
        position: relative;
        z-index: 2;
    }

    .title {
        font-size: 2.5rem;
        margin-bottom: 2rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: #ffffff;
        text-align: center;
        font-weight: 600;
    }

    .upload-section {
        background: #1e1e1e;
        border: 1px solid #2d2d2d;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .upload-form {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
    }

    .file-input {
        background: #2d2d2d;
        color: #e0e0e0;
        border: 1px solid #3d3d3d;
        padding: 0.8rem;
        border-radius: 8px;
        width: 100%;
        max-width: 400px;
        font-family: 'Inter', sans-serif;
        transition: all 0.3s ease;
    }

    .file-input:focus {
        outline: none;
        border-color: #4a4a4a;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
    }

    .btn {
        padding: 0.8rem 2rem;
        background: #2d2d2d;
        color: #ffffff;
        border: 1px solid #3d3d3d;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
    }

    .btn:hover {
        background: #3d3d3d;
        border-color: #4a4a4a;
        transform: translateY(-1px);
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
    }

    .dashboard-card {
        background: #1a1a1a;
        border: 1px solid #333333;
        border-radius: 12px;
        padding: 1.5rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .dashboard-card:hover {
        border-color: #404040;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        background: #1f1f1f;
    }

    .card-title {
        font-size: 1.3rem;
        margin-bottom: 1.2rem;
        color: #ffffff;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 2px solid #333333;
        padding-bottom: 0.8rem;
        font-weight: 600;
    }

    .chart-container {
        width: 100%;
        height: 300px;
        margin-top: 1rem;
        background: #242424;
        border-radius: 8px;
        padding: 1.2rem;
        border: 1px solid #333333;
    }

    .status-counts {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1.2rem;
        margin-top: 1.2rem;
    }

    .status-item {
        text-align: center;
        padding: 1rem;
        border: 1px solid #333333;
        border-radius: 8px;
        background: #242424;
        transition: all 0.3s ease;
        font-size: 1.1rem;
    }

    .status-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        background: #2a2a2a;
    }

    .status-item.success {
        color: #4CAF50;
        font-weight: 600;
    }

    .status-item.error {
        color: #f44336;
        font-weight: 600;
    }

    .anomaly-card {
        grid-column: 1 / -1;
        background: #1a1a1a;
        border: 1px solid #333333;
        border-radius: 12px;
        padding: 1.5rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .anomaly-card:hover {
        border-color: #404040;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        background: #1f1f1f;
    }

    .anomaly-table-container {
        width: 100%;
        overflow-x: auto;
        margin-top: 1.2rem;
        background: #242424;
        border-radius: 8px;
        padding: 1.2rem;
        border: 1px solid #333333;
    }

    .anomaly-table {
        width: 100%;
        border-collapse: collapse;
        color: #00ff00;
        font-size: 1.05rem;
    }

    .anomaly-table th,
    .anomaly-table td {
        border: 1px solid rgba(0, 255, 0, 0.3);
        padding: 1rem;
        text-align: left;
    }

    .anomaly-table th {
        background: rgba(0, 255, 0, 0.15);
        font-weight: bold;
        white-space: nowrap;
        color: #00ff00;
        font-size: 1.1rem;
    }

    .anomaly-table tbody tr {
        background: #242424;
        transition: all 0.3s ease;
    }

    .anomaly-table tbody tr:hover {
        background: rgba(0, 255, 0, 0.08);
    }

    .anomaly-type {
        font-weight: bold;
        color: #ff4444;
    }

    .anomaly-ip {
        color: #00ff00;
    }

    .anomaly-count {
        color: #00ff00;
    }

    .anomaly-time {
        color: #00ff00;
    }

    .error-analysis-card {
        grid-column: 1 / -1;
    }

    .error-summary {
        display: flex;
        gap: 2rem;
        margin-bottom: 1.2rem;
        justify-content: center;
    }

    .error-summary p {
        background: #242424;
        padding: 1rem 1.8rem;
        border-radius: 8px;
        border: 1px solid #333333;
        transition: all 0.3s ease;
        font-size: 1.1rem;
        font-weight: 500;
    }

    .error-summary p:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        background: #2a2a2a;
    }

    .error-table-container {
        width: 100%;
        overflow-x: auto;
        margin-top: 1.2rem;
        background: #242424;
        border-radius: 8px;
        padding: 1.2rem;
        border: 1px solid #333333;
    }

    .error-table {
        width: 100%;
        border-collapse: collapse;
        color: #00ff00;
        font-size: 1.05rem;
    }

    .error-table th,
    .error-table td {
        border: 1px solid rgba(0, 255, 0, 0.3);
        padding: 1rem;
        text-align: left;
        white-space: nowrap;
    }

    .error-table th {
        background: rgba(0, 255, 0, 0.15);
        font-weight: bold;
        color: #00ff00;
        font-size: 1.1rem;
    }

    .error-table tbody tr {
        background: #242424;
        transition: all 0.3s ease;
    }

    .error-table tbody tr:hover {
        background: rgba(0, 255, 0, 0.08);
    }

    .error-status {
        color: #ff4444;
        font-weight: bold;
    }

    .error-request {
        color: #00ff00;
    }

    .error-ip {
        color: #00ff00;
    }

    .error-time {
        color: #00ff00;
    }

    .sample-records {
        max-height: 400px;
        overflow-y: auto;
        padding: 1.2rem;
        background: #242424;
        border-radius: 8px;
        border: 1px solid #333333;
    }

    .sample-record {
        background: #1a1a1a;
        border: 1px solid #333333;
        border-radius: 8px;
        padding: 1.2rem;
        margin-bottom: 1.2rem;
        transition: all 0.3s ease;
    }

    .sample-record:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        background: #1f1f1f;
    }

    .sample-record p {
        margin: 0.6rem 0;
        font-size: 1.05rem;
    }

    .sample-record strong {
        color: #ffffff;
        font-weight: 600;
    }

    .hidden {
        display: none;
    }

    /* Scrollbar Stilleri */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: #1e1e1e;
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: #3d3d3d;
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #4a4a4a;
    }
</style>

<div class="log-container">
    <div class="dashboard">
        <h1 class="title">Log Analiz Paneli</h1>
        
        <div class="upload-section">
            <form id="upload-form" class="upload-form" enctype="multipart/form-data">
                <select id="log-type-select" class="file-input" required>
                    <option value="">Log Tipini Seçin</option>
                    <option value="apache">Apache Log</option>
                    <option value="syslog">Syslog</option>
                    <option value="application">Application Log</option>
                    <option value="firewall">Firewall Log</option>
                    <option value="windows">Windows Event Log</option>
                </select>
                <input type="file" id="log-file" name="file" class="file-input" required />
                <button type="submit" class="btn">Analiz Et</button>
            </form>
        </div>

        <div id="dashboard-content" class="hidden">
            <div class="dashboard-grid">
                <!-- Genel İstatistikler -->
                <div class="dashboard-card">
                    <h2 class="card-title">Genel İstatistikler</h2>
                    <div id="general-stats">
                        <p>Toplam Kayıt: <span id="total-lines">-</span></p>
                        <p>Log Tipi: <span id="log-type">-</span></p>
                    </div>
                </div>

                <!-- Zaman Bazlı Analiz (Syslog için) -->
                <div class="dashboard-card" id="time-analysis-card" style="display: none;">
                    <h2 class="card-title">Zaman Bazlı Analiz</h2>
                    <div class="chart-container">
                        <canvas id="time-chart"></canvas>
                    </div>
                </div>

                <!-- Durum Kodları (Apache için) -->
                <div class="dashboard-card" id="status-codes-card" style="display: none;">
                    <h2 class="card-title">Durum Kodları</h2>
                    <div class="status-counts" id="status-counts"></div>
                    <div class="chart-container">
                        <canvas id="status-chart"></canvas>
                    </div>
                </div>

                <!-- Program Analizi (Syslog için) -->
                <div class="dashboard-card" id="program-analysis-card" style="display: none;">
                    <h2 class="card-title">Program Analizi</h2>
                    <div class="chart-container">
                        <canvas id="program-chart"></canvas>
                    </div>
                </div>

                <!-- IP Analizi -->
                <div class="dashboard-card">
                    <h2 class="card-title">IP Analizi</h2>
                    <div class="chart-container">
                        <canvas id="ip-chart"></canvas>
                    </div>
                </div>

                <!-- Hata Analizi (Apache için) -->
                <div class="dashboard-card error-analysis-card" id="error-analysis-card" style="display: none;">
                    <h2 class="card-title">Hata Analizi</h2>
                    <div id="error-analysis">
                        <div class="error-summary">
                            <p>4xx Hataları: <span id="total-4xx">-</span></p>
                            <p>5xx Hataları: <span id="total-5xx">-</span></p>
                        </div>
                        <div class="chart-container">
                            <canvas id="error-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Örnek Kayıtlar (Syslog için) -->
                <div class="dashboard-card" id="sample-records-card" style="display: none;">
                    <h2 class="card-title">Örnek Kayıtlar</h2>
                    <div id="sample-records" class="sample-records"></div>
                </div>

                <!-- Anomali Raporu -->
                <div class="dashboard-card anomaly-card">
                    <h2 class="card-title">Anomali Raporu</h2>
                    <div class="anomaly-table-container">
                        <table class="anomaly-table" id="anomaly-table">
                            <thead>
                                <tr>
                                    <th>Tip</th>
                                    <th>IP</th>
                                    <th>Toplam Deneme/Hata</th>
                                    <th>Son İşlem Zamanı</th>
                                </tr>
                            </thead>
                            <tbody id="anomaly-list">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.getElementById('upload-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Önceki sonuçları temizle
    clearPreviousResults();
    
    const formData = new FormData();
    const fileInput = document.getElementById('log-file');
    const logType = document.getElementById('log-type-select').value;
    
    if (!logType) {
        alert('Lütfen log tipini seçin!');
        return;
    }
    
    formData.append('file', fileInput.files[0]);

    let endpoint;
    switch(logType) {
        case 'apache':
            endpoint = 'http://localhost:8090/analyze-apache';
            break;
        case 'syslog':
            endpoint = 'http://localhost:8090/analyze-syslog';
            break;
        case 'application':
            endpoint = 'http://localhost:8090/analyze-application';
            break;
        case 'firewall':
            endpoint = 'http://localhost:8090/analyze-firewall';
            break;
        case 'windows':
            endpoint = 'http://localhost:8090/analyze-windows';
            break;
        default:
            alert('Geçersiz log tipi!');
            return;
    }

    fetch(endpoint, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('dashboard-content').classList.remove('hidden');
        updateDashboard(data, logType);
    })
    .catch(error => {
        console.error('Hata:', error);
        alert('Log analizi sırasında bir hata oluştu!');
    });
});

// Önceki sonuçları temizleme fonksiyonu
function clearPreviousResults() {
    // Tüm grafikleri temizle
    const chartIds = ['time-chart', 'status-chart', 'program-chart', 'ip-chart', 'error-chart'];
    chartIds.forEach(id => {
        const canvas = document.getElementById(id);
        if (canvas) {
            const chart = Chart.getChart(canvas);
            if (chart) {
                chart.destroy();
            }
        }
    });

    // Tüm tabloları ve içerikleri temizle
    document.getElementById('status-counts').innerHTML = '';
    document.getElementById('anomaly-list').innerHTML = '';
    document.getElementById('sample-records').innerHTML = '';
    
    // Genel istatistikleri sıfırla
    document.getElementById('total-lines').textContent = '-';
    document.getElementById('log-type').textContent = '-';
    
    // Hata analizi sonuçlarını sıfırla
    document.getElementById('total-4xx').textContent = '-';
    document.getElementById('total-5xx').textContent = '-';
    
    // Dashboard'u gizle
    document.getElementById('dashboard-content').classList.add('hidden');
}

function updateDashboard(data, logType) {
    // Kartları göster/gizle
    document.getElementById('status-codes-card').style.display = 
        (logType === 'apache' || logType === 'application' || logType === 'windows') ? 'block' : 'none';
    document.getElementById('error-analysis-card').style.display = 
        (logType === 'apache' || logType === 'application' || logType === 'windows') ? 'block' : 'none';
    document.getElementById('time-analysis-card').style.display = 
        (logType === 'syslog' || logType === 'application' || logType === 'firewall' || logType === 'windows') ? 'block' : 'none';
    document.getElementById('program-analysis-card').style.display = 
        (logType === 'syslog' || logType === 'application' || logType === 'windows') ? 'block' : 'none';
    document.getElementById('sample-records-card').style.display = 
        (logType === 'syslog' || logType === 'application' || logType === 'firewall' || logType === 'windows') ? 'block' : 'none';

    // Genel İstatistikler
    document.getElementById('total-lines').textContent = data.toplam_kayit;
    document.getElementById('log-type').textContent = data.log_type;

    switch(logType) {
        case 'apache':
            updateApacheDashboard(data);
            break;
        case 'syslog':
            updateSyslogDashboard(data);
            break;
        case 'application':
            updateApplicationDashboard(data);
            break;
        case 'firewall':
            updateFirewallDashboard(data);
            break;
        case 'windows':
            updateWindowsDashboard(data);
            break;
    }
}

function updateApacheDashboard(data) {
    // Genel İstatistikler
    document.getElementById('total-lines').textContent = data.toplam_kayit;
    document.getElementById('log-type').textContent = data.log_type;

    // Durum Kodları
    const statusCounts = document.getElementById('status-counts');
    statusCounts.innerHTML = '';
    for (const [status, count] of Object.entries(data.status_counts)) {
        const statusItem = document.createElement('div');
        statusItem.className = `status-item ${status.startsWith('2') ? 'success' : 'error'}`;
        statusItem.innerHTML = `<strong>Status ${status}</strong><br>${count}`;
        statusCounts.appendChild(statusItem);
    }

    // Durum Kodları Grafiği
    new Chart(document.getElementById('status-chart'), {
        type: 'pie',
        data: {
            labels: Object.keys(data.status_counts),
            datasets: [{
                data: Object.values(data.status_counts),
                backgroundColor: [
                    '#FF6B6B', // Mercan kırmızısı
                    '#4ECDC4', // Turkuaz
                    '#45B7D1', // Mavi
                    '#96CEB4', // Mint
                    '#FFEEAD', // Krem
                    '#D4A5A5', // Gül
                    '#9B59B6', // Mor
                    '#3498DB'  // Mavi
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#00ff00'
                    }
                }
            }
        }
    });

    // Anomali Raporu
    const anomalyList = document.getElementById('anomaly-list');
    anomalyList.innerHTML = '';
    if (data.anomali_raporu) {
        data.anomali_raporu.forEach(anomaly => {
            const tr = document.createElement('tr');
            
            let count = '';
            let time = '';
            
            if (anomaly.tip === 'brute_force_saldirisi') {
                count = anomaly.toplam_deneme;
                time = anomaly.son_deneme;
            } else if (anomaly.tip === 'yuksek_hata_orani') {
                count = anomaly.toplam_hata;
                time = anomaly.son_hata;
            } else if (anomaly.tip === 'supheli_dosya_erisimi') {
                count = anomaly.toplam_deneme;
                time = anomaly.son_deneme;
            }
            
            tr.innerHTML = `
                <td class="anomaly-type">${anomaly.tip}</td>
                <td class="anomaly-ip">${anomaly.ip}</td>
                <td class="anomaly-count">${count}</td>
                <td class="anomaly-time">${time}</td>
            `;
            anomalyList.appendChild(tr);
        });
    }

    // IP Analizi
    if (data.ip_bazli_analiz && data.ip_bazli_analiz.ip_detaylari) {
        updateIPChart(data.ip_bazli_analiz.ip_detaylari);
    }

    // Hata Analizi
    if (data.hata_analizi) {
        document.getElementById('total-4xx').textContent = data.hata_analizi.total_4xx_errors;
        document.getElementById('total-5xx').textContent = data.hata_analizi.total_5xx_errors;

        // Hata Analizi Grafiği
        new Chart(document.getElementById('error-chart'), {
            type: 'doughnut',
            data: {
                labels: ['4xx Hataları', '5xx Hataları'],
                datasets: [{
                    data: [
                        data.hata_analizi.total_4xx_errors,
                        data.hata_analizi.total_5xx_errors
                    ],
                    backgroundColor: ['#00ff00', '#ff4444']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                }
            }
        });

        // Top Hatalar Tablosu
        const errorAnalysis = document.getElementById('error-analysis');
        if (data.hata_analizi.top_errors && data.hata_analizi.top_errors.length > 0) {
            const topErrorsDiv = document.createElement('div');
            topErrorsDiv.className = 'error-table-container';
            topErrorsDiv.innerHTML = '<h3>En Sık Karşılaşılan Hatalar</h3>';
            
            const table = document.createElement('table');
            table.className = 'error-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Durum</th>
                        <th>İstek</th>
                        <th>IP</th>
                        <th>Zaman</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.hata_analizi.top_errors.map(error => `
                        <tr>
                            <td class="error-status">${error.status}</td>
                            <td class="error-request">${error.request_line}</td>
                            <td class="error-ip">${error.ip}</td>
                            <td class="error-time">${error.timestamp}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            topErrorsDiv.appendChild(table);
            errorAnalysis.appendChild(topErrorsDiv);
        }
    }

    // Zaman Bazlı Analiz
    if (data.zaman_bazli_analiz) {
        const timeAnalysisCard = document.getElementById('time-analysis-card');
        timeAnalysisCard.style.display = 'block';
        
        new Chart(document.getElementById('time-chart'), {
            type: 'line',
            data: {
                labels: Object.keys(data.zaman_bazli_analiz),
                datasets: [{
                    label: 'İstek Sayısı',
                    data: Object.values(data.zaman_bazli_analiz),
                    borderColor: '#00ff00',
                    backgroundColor: 'rgba(0, 255, 0, 0.1)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    }
                }
            }
        });
    }
}

function updateSyslogDashboard(data) {
    // Zaman Bazlı Analiz
    if (data.zaman_bazli_analiz) {
        new Chart(document.getElementById('time-chart'), {
            type: 'line',
            data: {
                labels: Object.keys(data.zaman_bazli_analiz),
                datasets: [{
                    label: 'Kayıt Sayısı',
                    data: Object.values(data.zaman_bazli_analiz),
                    borderColor: '#00ff00',
                    backgroundColor: 'rgba(0, 255, 0, 0.1)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    }
                }
            }
        });
    }

    // Program Analizi
    if (data.program_analizi) {
        new Chart(document.getElementById('program-chart'), {
            type: 'pie',
            data: {
                labels: Object.keys(data.program_analizi),
                datasets: [{
                    data: Object.values(data.program_analizi),
                    backgroundColor: [
                        '#FF6B6B', // Mercan kırmızısı
                        '#4ECDC4', // Turkuaz
                        '#45B7D1', // Mavi
                        '#96CEB4', // Mint
                        '#FFEEAD', // Krem
                        '#D4A5A5', // Gül
                        '#9B59B6', // Mor
                        '#3498DB'  // Mavi
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                }
            }
        });
    }

    // Anomali Raporu
    const anomalyList = document.getElementById('anomaly-list');
    anomalyList.innerHTML = '';
    if (data.anomali_raporu) {
        data.anomali_raporu.forEach(anomaly => {
            const tr = document.createElement('tr');
            
            if (typeof anomaly === 'string') {
                tr.innerHTML = `
                    <td class="anomaly-type" colspan="4">${anomaly}</td>
                `;
            } else {
                let count = '';
                let time = '';
                
                if (anomaly.tip === 'yuksek_basarisiz_giris') {
                    count = anomaly.toplam_deneme;
                    time = 'N/A';
                }
                
                tr.innerHTML = `
                    <td class="anomaly-type">${anomaly.tip}</td>
                    <td class="anomaly-ip" colspan="2">${Object.entries(anomaly.ip_detaylari)
                        .map(([ip, count]) => `${ip}: ${count}`)
                        .join('<br>')}</td>
                    <td class="anomaly-time">${time}</td>
                `;
            }
            anomalyList.appendChild(tr);
        });
    }

    // IP Analizi
    if (data.ip_bazli_analiz && data.ip_bazli_analiz.auth_ip_detaylari) {
        updateIPChart(data.ip_bazli_analiz.auth_ip_detaylari);
    }

    // Örnek Kayıtlar
    if (data.ornek_kayitlar) {
        const sampleRecords = document.getElementById('sample-records');
        sampleRecords.innerHTML = '';
        data.ornek_kayitlar.forEach(record => {
            const recordDiv = document.createElement('div');
            recordDiv.className = 'sample-record';
            recordDiv.innerHTML = `
                <p><strong>Zaman:</strong> ${record.timestamp}</p>
                <p><strong>Host:</strong> ${record.host}</p>
                <p><strong>Program:</strong> ${record.program}</p>
                <p><strong>Mesaj:</strong> ${record.message}</p>
                ${record.user ? `<p><strong>Kullanıcı:</strong> ${record.user}</p>` : ''}
                ${record.ip ? `<p><strong>IP:</strong> ${record.ip}</p>` : ''}
            `;
            sampleRecords.appendChild(recordDiv);
        });
    }
}

function updateApplicationDashboard(data) {
    // Zaman Bazlı Analiz
    if (data.zaman_bazli_analiz) {
        new Chart(document.getElementById('time-chart'), {
            type: 'line',
            data: {
                labels: Object.keys(data.zaman_bazli_analiz),
                datasets: [{
                    label: 'İstek Sayısı',
                    data: Object.values(data.zaman_bazli_analiz),
                    borderColor: '#00ff00',
                    backgroundColor: 'rgba(0, 255, 0, 0.1)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    }
                }
            }
        });
    }

    // IP Analizi
    if (data.ip_bazli_analiz && data.ip_bazli_analiz.ip_detaylari) {
        const ipChartData = Object.entries(data.ip_bazli_analiz.ip_detaylari)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 10);

        new Chart(document.getElementById('ip-chart'), {
            type: 'bar',
            data: {
                labels: ipChartData.map(item => item[0]),
                datasets: [{
                    label: 'İstek Sayısı',
                    data: ipChartData.map(item => item[1]),
                    backgroundColor: '#00ff00'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            color: '#00ff00'
                        },
                        grid: {
                            color: 'rgba(0, 255, 0, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#00ff00'
                        },
                        grid: {
                            color: 'rgba(0, 255, 0, 0.1)'
                        }
                    }
                }
            }
        });
    }

    // Endpoint Analizi
    if (data.ip_bazli_analiz && data.ip_bazli_analiz.endpoint_detaylari) {
        const endpointChartData = Object.entries(data.ip_bazli_analiz.endpoint_detaylari)
            .sort((a, b) => b[1] - a[1]);

        new Chart(document.getElementById('program-chart'), {
            type: 'pie',
            data: {
                labels: endpointChartData.map(item => item[0]),
                datasets: [{
                    data: endpointChartData.map(item => item[1]),
                    backgroundColor: [
                        '#FF6B6B', // Mercan kırmızısı
                        '#4ECDC4', // Turkuaz
                        '#45B7D1', // Mavi
                        '#96CEB4', // Mint
                        '#FFEEAD', // Krem
                        '#D4A5A5', // Gül
                        '#9B59B6', // Mor
                        '#3498DB'  // Mavi
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                }
            }
        });
    }

    // Method Analizi
    if (data.ip_bazli_analiz && data.ip_bazli_analiz.method_detaylari) {
        const methodChartData = Object.entries(data.ip_bazli_analiz.method_detaylari)
            .sort((a, b) => b[1] - a[1]);

        new Chart(document.getElementById('status-chart'), {
            type: 'pie',
            data: {
                labels: methodChartData.map(item => item[0]),
                datasets: [{
                    data: methodChartData.map(item => item[1]),
                    backgroundColor: [
                        '#FF6B6B', // Mercan kırmızısı
                        '#4ECDC4', // Turkuaz
                        '#45B7D1', // Mavi
                        '#96CEB4', // Mint
                        '#FFEEAD', // Krem
                        '#D4A5A5', // Gül
                        '#9B59B6', // Mor
                        '#3498DB'  // Mavi
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                }
            }
        });
    }

    // Status Code Analizi
    if (data.ip_bazli_analiz && data.ip_bazli_analiz.status_code_detaylari) {
        const statusCounts = document.getElementById('status-counts');
        statusCounts.innerHTML = '';
        for (const [status, count] of Object.entries(data.ip_bazli_analiz.status_code_detaylari)) {
            const statusItem = document.createElement('div');
            statusItem.className = `status-item ${status.startsWith('2') ? 'success' : 'error'}`;
            statusItem.innerHTML = `<strong>${status}</strong><br>${count}`;
            statusCounts.appendChild(statusItem);
        }
    }

    // Anomali Raporu
    if (data.anomali_raporu) {
        const anomalyList = document.getElementById('anomaly-list');
        anomalyList.innerHTML = '';
        
        data.anomali_raporu.forEach(anomaly => {
            const tr = document.createElement('tr');
            let count = '';
            let time = '';
            
            if (anomaly.tip === 'yuksek_response_time') {
                count = anomaly.yavas_yanit_sayisi;
                time = anomaly.son_yavas_yanit;
            } else if (anomaly.tip === 'supheli_user_agent') {
                count = anomaly.istek_sayisi;
                time = anomaly.son_istek;
            }
            
            tr.innerHTML = `
                <td class="anomaly-type">${anomaly.tip}</td>
                <td class="anomaly-ip">${anomaly.ip}</td>
                <td class="anomaly-count">${count}</td>
                <td class="anomaly-time">${time}</td>
            `;
            anomalyList.appendChild(tr);
        });
    }

    // Örnek Kayıtlar
    if (data.ornek_kayitlar) {
        const sampleRecords = document.getElementById('sample-records');
        sampleRecords.innerHTML = '';
        data.ornek_kayitlar.forEach(record => {
            const recordDiv = document.createElement('div');
            recordDiv.className = 'sample-record';
            recordDiv.innerHTML = `
                <p><strong>Zaman:</strong> ${record.timestamp}</p>
                <p><strong>Seviye:</strong> ${record.level}</p>
                <p><strong>Servis:</strong> ${record.service}</p>
                <p><strong>Endpoint:</strong> ${record.endpoint}</p>
                <p><strong>Method:</strong> ${record.method}</p>
                <p><strong>Status Code:</strong> ${record.status_code}</p>
                <p><strong>Kullanıcı ID:</strong> ${record.user_id}</p>
                <p><strong>IP:</strong> ${record.ip}</p>
                <p><strong>User Agent:</strong> ${record.user_agent}</p>
                <p><strong>Request Body:</strong> ${record.request_body}</p>
                <p><strong>Response Time:</strong> ${record.response_time}ms</p>
                <p><strong>Hata Mesajı:</strong> ${record.error_message}</p>
            `;
            sampleRecords.appendChild(recordDiv);
        });
    }
}

function updateFirewallDashboard(data) {
    // Zaman Bazlı Analiz
    if (data.zaman_bazli_analiz) {
        new Chart(document.getElementById('time-chart'), {
            type: 'line',
            data: {
                labels: Object.keys(data.zaman_bazli_analiz),
                datasets: [{
                    label: 'Trafik Sayısı',
                    data: Object.values(data.zaman_bazli_analiz),
                    borderColor: '#00ff00',
                    backgroundColor: 'rgba(0, 255, 0, 0.1)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    }
                }
            }
        });
    }

    // IP Analizi
    if (data.ip_bazli_analiz) {
        const ipChartData = Object.entries(data.ip_bazli_analiz)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 10);

        new Chart(document.getElementById('ip-chart'), {
            type: 'bar',
            data: {
                labels: ipChartData.map(item => item[0]),
                datasets: [{
                    label: 'Trafik Sayısı',
                    data: ipChartData.map(item => item[1]),
                    backgroundColor: '#00ff00'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            color: '#00ff00'
                        },
                        grid: {
                            color: 'rgba(0, 255, 0, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#00ff00'
                        },
                        grid: {
                            color: 'rgba(0, 255, 0, 0.1)'
                        }
                    }
                }
            }
        });
    }

    // Anomali Raporu
    if (data.anomali_raporu) {
        const anomalyList = document.getElementById('anomaly-list');
        anomalyList.innerHTML = '';
        
        data.anomali_raporu.forEach(anomaly => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="anomaly-type">${anomaly.tip}</td>
                <td class="anomaly-ip">${anomaly.ip}</td>
                <td class="anomaly-count">${anomaly.toplam_deneme}</td>
                <td class="anomaly-time">${anomaly.son_deneme}</td>
            `;
            anomalyList.appendChild(tr);
        });
    }

    // Örnek Kayıtlar
    if (data.ornek_kayitlar) {
        const sampleRecords = document.getElementById('sample-records');
        sampleRecords.innerHTML = '';
        data.ornek_kayitlar.forEach(record => {
            const recordDiv = document.createElement('div');
            recordDiv.className = 'sample-record';
            recordDiv.innerHTML = `
                <p><strong>Zaman:</strong> ${record.timestamp}</p>
                <p><strong>Aksiyon:</strong> ${record.action}</p>
                <p><strong>Protokol:</strong> ${record.protocol}</p>
                <p><strong>Kaynak IP:</strong> ${record.src_ip}</p>
                <p><strong>Hedef IP:</strong> ${record.dst_ip}</p>
                <p><strong>Kaynak Port:</strong> ${record.src_port}</p>
                <p><strong>Hedef Port:</strong> ${record.dst_port}</p>
                <p><strong>TCP Bayrakları:</strong> ${record.tcp_flags}</p>
                <p><strong>Giriş Arayüzü:</strong> ${record.in_interface}</p>
                <p><strong>Çıkış Arayüzü:</strong> ${record.out_interface || 'N/A'}</p>
            `;
            sampleRecords.appendChild(recordDiv);
        });
    }
}

function updateWindowsDashboard(data) {
    // Zaman Bazlı Analiz
    if (data.zaman_bazli_analiz) {
        new Chart(document.getElementById('time-chart'), {
            type: 'line',
            data: {
                labels: Object.keys(data.zaman_bazli_analiz),
                datasets: [{
                    label: 'Olay Sayısı',
                    data: Object.values(data.zaman_bazli_analiz),
                    borderColor: '#00ff00',
                    backgroundColor: 'rgba(0, 255, 0, 0.1)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#00ff00' },
                        grid: { color: 'rgba(0, 255, 0, 0.1)' }
                    }
                }
            }
        });
    }

    // Program Analizi (Event ID'ler)
    if (data.program_analizi) {
        new Chart(document.getElementById('program-chart'), {
            type: 'pie',
            data: {
                labels: Object.keys(data.program_analizi),
                datasets: [{
                    data: Object.values(data.program_analizi),
                    backgroundColor: [
                        '#FF6B6B', // Mercan kırmızısı
                        '#4ECDC4', // Turkuaz
                        '#45B7D1', // Mavi
                        '#96CEB4', // Mint
                        '#FFEEAD', // Krem
                        '#D4A5A5', // Gül
                        '#9B59B6', // Mor
                        '#3498DB'  // Mavi
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                }
            }
        });
    }

    // Örnek Kayıtlar
    if (data.ornek_kayitlar) {
        const sampleRecords = document.getElementById('sample-records');
        sampleRecords.innerHTML = '';
        data.ornek_kayitlar.forEach(record => {
            const recordDiv = document.createElement('div');
            recordDiv.className = 'sample-record';
            recordDiv.innerHTML = `
                <p><strong>Zaman:</strong> ${record.timestamp}</p>
                <p><strong>Event ID:</strong> ${record.event_id}</p>
                <p><strong>Kaynak:</strong> ${record.source}</p>
                <p><strong>Seviye:</strong> ${record.level}</p>
                <p><strong>Kullanıcı:</strong> ${record.user || 'N/A'}</p>
                <p><strong>Bilgisayar:</strong> ${record.computer}</p>
                <p><strong>Mesaj:</strong> ${record.message}</p>
                ${record.category ? `<p><strong>Kategori:</strong> ${record.category}</p>` : ''}
                ${record.process_id ? `<p><strong>Process ID:</strong> ${record.process_id}</p>` : ''}
                ${record.thread_id ? `<p><strong>Thread ID:</strong> ${record.thread_id}</p>` : ''}
            `;
            sampleRecords.appendChild(recordDiv);
        });
    }

    // Durum Kodları (Event Seviyeleri)
    if (data.status_counts) {
        const statusCounts = document.getElementById('status-counts');
        statusCounts.innerHTML = '';
        for (const [status, count] of Object.entries(data.status_counts)) {
            const statusItem = document.createElement('div');
            statusItem.className = `status-item ${status.toLowerCase()}`;
            statusItem.innerHTML = `<strong>${status}</strong><br>${count}`;
            statusCounts.appendChild(statusItem);
        }
    }

    // Hata Analizi
    if (data.hata_analizi) {
        document.getElementById('total-4xx').textContent = data.hata_analizi.total_warnings || 0;
        document.getElementById('total-5xx').textContent = data.hata_analizi.total_errors || 0;

        // Hata Analizi Grafiği
        new Chart(document.getElementById('error-chart'), {
            type: 'doughnut',
            data: {
                labels: ['Uyarılar', 'Hatalar'],
                datasets: [{
                    data: [
                        data.hata_analizi.total_warnings || 0,
                        data.hata_analizi.total_errors || 0
                    ],
                    backgroundColor: ['#00ff00', '#ff4444']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#00ff00'
                        }
                    }
                }
            }
        });
    }
}

function updateIPChart(ipData) {
    const ipChartData = Object.entries(ipData)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);

    new Chart(document.getElementById('ip-chart'), {
        type: 'bar',
        data: {
            labels: ipChartData.map(item => item[0]),
            datasets: [{
                label: 'İstek Sayısı',
                data: ipChartData.map(item => item[1]),
                backgroundColor: '#00ff00'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#00ff00'
                    }
                }
            },
            scales: {
                y: {
                    ticks: {
                        color: '#00ff00'
                    },
                    grid: {
                        color: 'rgba(0, 255, 0, 0.1)'
                    }
                },
                x: {
                    ticks: {
                        color: '#00ff00'
                    },
                    grid: {
                        color: 'rgba(0, 255, 0, 0.1)'
                    }
                }
            }
        }
    });
}
</script>
{% endblock %}